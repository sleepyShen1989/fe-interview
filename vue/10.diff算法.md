# diff算法

## 引入原因

- Vue1.x
  - 每个依赖均有更新函数对应，可以做到精准更新，并不需要虚拟DOM和patching算法
  - 粒度过细导致无法承载较大应用（动态内容多，需要维护大量更新函数，内存崩溃）
- Vue2.x
  - 降低Watcher粒度，每个组件只有一个Watcher与之对应

## 执行时刻

组件内响应式数据变更触发实例执行其更新函数时，更新函数会再次执行render函数获得最新的虚拟DOM，然后执行patch函数，并传入新旧两次虚拟DOM，通过比对两者找到变化的地方，最后将其转化为对应的DOM

## 执行方式

patch过程是一个递归过程，遵循深度优先，同层比较策略

### Vue3 patch

1. 判断两个节点是否为相同同类节点，不同则删除重新创建
2. 如果双方都是文本则更新文本内容
3. 如果双方都是元素节点则递归更新子元素，同时更新元素属性
4. Vue3中引入的更新策略：编译期优化 patchFlags,block